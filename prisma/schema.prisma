generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Events {
  name        String
  track       String?
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @default(now()) @updatedAt
  approved    Boolean          @default(false)
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  link        String?          @default("")
  trackId     String?          @db.Uuid
  description String?
  responses   EventResponses[]
  eventTrack  Tracks?          @relation(fields: [trackId], references: [id])
}

model EventResponses {
  id      String @id @default(dbgenerated("gen_random_uuid()"))
  userId  String
  eventId String @db.Uuid
  event   Events @relation(fields: [eventId], references: [id])
  user    Users  @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
}

model Tracks {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  description String?
  image       String
  lat         Float
  lng         Float
  types       TrackTypes[]
  url         String
  slug        String        @default("")
  events      Events[]
  Products    Products[]
  owners      TrackOwners[]
}

model Drivers {
  id              String                  @id @default(dbgenerated("gen_random_uuid()"))
  createdAt       DateTime                @default(now())
  name            String
  champNo         Int?
  team            String?
  qualiPositions  Int[]
  leftBattles     Battles[]               @relation("battleDriverLeft")
  rightBattles    Battles[]               @relation("battleDriverRight")
  battleStandings DriverBattleStandings[]
  ratingsWins     DriverRatingBattles[]   @relation("driverRatingsWins")
  ratingsLosses   DriverRatingBattles[]   @relation("driverRatingsLosses")
}

model Battles {
  createdAt     DateTime @default(now())
  tournament    String
  driverLeftId  String?
  driverRightId String?
  winnerId      String?
  id            Int      @id @default(autoincrement())
  driverLeft    Drivers? @relation("battleDriverLeft", fields: [driverLeftId], references: [id])
  driverRight   Drivers? @relation("battleDriverRight", fields: [driverRightId], references: [id])
}

model DriverRatingBattles {
  id         Int      @id @default(autoincrement())
  createdAt  DateTime @default(now())
  tournament String
  loserId    String
  winnerId   String
  winner     Drivers  @relation("driverRatingsWins", fields: [winnerId], references: [id])
  loser      Drivers  @relation("driverRatingsLosses", fields: [loserId], references: [id])
}

model DriverBattleStandings {
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
  id         Int      @id @default(autoincrement())
  tournament String
  driverId   String
  position   Int
  qualiBonus Int      @default(0)
  driver     Drivers  @relation(fields: [driverId], references: [id])
}

model Users {
  createdAt DateTime         @default(now())
  updatedAt DateTime         @default(now()) @updatedAt
  id        String           @id
  firstName String?
  image     String?
  lastName  String?
  events    EventResponses[]
  tracks    TrackOwners[]
}

model TrackOwners {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  userId    String
  trackId   String   @db.Uuid
  track     Tracks   @relation(fields: [trackId], references: [id])
  owner     Users    @relation(fields: [userId], references: [id])
}

model Products {
  slug        String        @id
  title       String
  image       String
  description String
  shop        Shops
  url         String
  trackId     String?       @db.Uuid
  status      ProductStatus @default(UNKNOWN)
  Tracks      Tracks?       @relation(fields: [trackId], references: [id])
}

enum TrackTypes {
  ALL
  TRACKS
  CLUBS
  SHOPS
}

enum Shops {
  ASBO
  RCKITOUT
  A0_RCKITOUT // For Sorting
  DRIFTMANJI
  SLIDEDYNAMICS
  RCPACE
  MODELSHOPDIRECT
}

enum ProductStatus {
  IN_STOCK
  SOLD_OUT
  BACKORDER
  UNKNOWN
}
